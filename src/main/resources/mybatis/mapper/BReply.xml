<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.healthplan.work.dao.BReplyMapper">

    <!-- 모든 댓글 목록 조회 -->
    <select id="getReplyList" resultType="com.healthplan.work.vo.BReplyEntity">
        SELECT rno, bno, mno, rComment, rRegdate
        FROM BReply
        ORDER BY rRegdate DESC
    </select>

    <!-- 특정 게시글의 댓글 목록 조회 -->
    <select id="getRepliesByBno" parameterType="int" resultType="com.healthplan.work.vo.BReplyEntity">
        SELECT rno, bno, mno, rComment, rRegdate
        FROM BReply
        WHERE bno = #{bno}
        ORDER BY rRegdate DESC
    </select>

    <!-- 댓글 등록 -->
    <insert id="insertReply" parameterType="com.healthplan.work.vo.BReplyEntity" useGeneratedKeys="true" keyProperty="rno">
        <!-- 시퀀스를 통한 rno 값 생성 -->
        <selectKey keyProperty="rno" resultType="int" order="BEFORE">
            SELECT BReply_seq.NEXTVAL AS rno FROM DUAL
        </selectKey>
        INSERT INTO BReply (rno, bno, mno, rComment, rRegdate)
        VALUES (#{rno}, #{bno}, #{mno}, #{rComment}, SYSDATE)
    </insert>

    <!-- 댓글 수정 -->
    <update id="updateReply" parameterType="com.healthplan.work.vo.BReplyEntity">
        UPDATE BReply
        SET rComment = #{rComment}
        WHERE rno = #{rno}
    </update>

    <!-- 댓글 삭제 -->
    <delete id="deleteReply" parameterType="int">
        DELETE FROM BReply
        WHERE rno = #{rno}
    </delete>

    <!-- 댓글 상세 조회 -->
    <select id="getReply" parameterType="int" resultType="com.healthplan.work.vo.BReplyEntity">
        SELECT rno, bno, mno, rComment, rRegdate
        FROM BReply
        WHERE rno = #{rno}
    </select>

</mapper>
